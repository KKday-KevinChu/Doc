var RETUID_COOKIE="__retuid";var FPID_COOKIE="__fpid";var ICEM_FPID="";var ICEM_FT="f";var RETFSESS_COOKIE="__retfs";var WECHAT_OPENID_COOKIE="__wopenid";var FB_OPENID_COOKIE="__fbopenid";var LINE_OPENID_COOKIE="__lopenid";var MEMBER_SYNC_COOKIE="__syncMember";var ICEM_MEMBERID_COOKIE="__icemMemberId";var ICEM_AUTH_SESSION="__icemSession";var TRY_LINE_AUTH_COOKIE="tryLineAuth";var TRY_WECHAT_AUTH_COOKIE="tryWechatAuth";var AUTH_INFO_COOKIE="authInfo";var DEFAULT_TRY_AUTH_COOKIE_MINUTES=0;var PARAM_RET_CLICK_LABEL="clkLabel";var PARAM_RET_TYPE="retType";var PARAM_RET_CERT="retCrt";var PARAM_REC_ITEM_ID="recItemId";var PARAM_REC_DOM_ID="recDomId";var PARAM_REC_RULE_ID="recommendId";var PARAM_ITEM_ID="vItemId";var PARAM_WECHAT_ID="wechatId";var PARAM_SESSION_ID="sessionId";var PARAM_OUTSIDE_SRC="fromOutLink";var PARAM_SHOPPING_DETAIL="shopDetail";var PARAM_CART_DETAIL="cartDetail";var PARAM_APP_NAME="app";var PARAM_CUSTOM_FIELD="ext";var PARAM_SITE_MEMBER="siteMember";var PARAM_FROM="from";var FROM_CONTAINER_TAG="ct";var PARAM_VERSION="v";var previousUrl="";var RET_TYPE_TRACK="track";var RET_TYPE_RET_IMPRESSION="retImpr";var RET_TYPE_RET_CLICK="retClk";var RET_TYPE_BUY="buy";var RET_TYPE_CART="cart";var RET_TYPE_SITE_CLICK="siteClk";var RET_TYPE_SITE_CLICK_IMPRESSION="siteClkImpr";var FETCH_COOKIENAME_KEY="fetchCookieName-";var MARK_CLICK_FROM_RET="recMark=2";var MARK_CLICK_FROM_SITE="recMark=1";var VERSION_CONTAINER_TAG="3.13.3";var SRV_HTML_PATH="srv.html?"+VERSION_CONTAINER_TAG;var CRX_RETUID_RETFSESS="retuid-and-retfs";var CRX_RETFSESS="retfs";var CRX_MEMBER_ID=PARAM_SITE_MEMBER;var RET_CUR_PATH="retp";var IN_RET_CLUB=false;var RET=RET||{};if(!String.prototype.startsWith){String.prototype.startsWith=function(b,a){a=a||0;return this.indexOf(b,a)===a}}Number.isInteger=Number.isInteger||function(a){return typeof a==="number"&&isFinite(a)&&Math.floor(a)===a};if(typeof String.prototype.trim!=="function"){String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}}if(typeof(console)=="undefined"){console={};console.log=function(){}}if(!Object.keys){Object.keys=function(c){var b=[];for(var a in c){if(c.hasOwnProperty(a)){b.push(a)}}return b}}if(!document.querySelectorAll){document.querySelectorAll=function(b){var c=document.createElement("style"),d=[],a;document.documentElement.firstChild.appendChild(c);document._qsa=[];c.styleSheet.cssText=b+"{x-qsa:expression(document._qsa && document._qsa.push(this))}";window.scrollBy(0,0);c.parentNode.removeChild(c);while(document._qsa.length){a=document._qsa.shift();a.style.removeAttribute("x-qsa");d.push(a)}document._qsa=null;return d}}RET.loadJS=new function(){var a="";return{init:function(){},loadScripts:function(b,d){var c=function(i){var f,g;if(window.XDomainRequest){f=new XDomainRequest()}else{if(window.XMLHttpRequest){f=new XMLHttpRequest()}else{try{f=new ActiveXObject("Microsoft.XMLHTTP")}catch(h){return}}}f.onload=function(){var e=document.createElement("script");e.type="text/javascript";e.text=f.responseText;document.getElementsByTagName("head")[0].appendChild(e);document.head.removeChild(e);g=b.shift();if(g){c(g)}else{if(typeof d==="function"){d()}}};f.open("GET",retUrlPrefix+i,true);f.send()};c(b.shift())},mainProcess:function(){var o=365;MAIN_PROCESS=this;this._retUid=RET.cookieObj.getLocalCookie(RETUID_COOKIE);RET.cookieObj.clearSafariLocalCookie();this.m_extra_param={};this.m_extra_param_q={};console.log("ret.js: mainProcess: get local cookie "+this._retUid);var d=function(){var v=window.location.href;if(v.indexOf(MARK_CLICK_FROM_SITE)>0){return RET_TYPE_SITE_CLICK}else{if(v.indexOf(MARK_CLICK_FROM_RET)>0){return RET_TYPE_RET_CLICK}else{if(typeof retOrderList!="undefined"){return RET_TYPE_BUY}else{if(typeof retCartList!="undefined"){return RET_TYPE_CART}else{return RET_TYPE_TRACK}}}}};var n=function(){if(typeof retApp=="undefined"){return"WEB"}else{return retApp}};var k={};var m=[false,false,false,false];var c=RET.utils.getDocHeight();var l=[];var r=null;var p=null;var e=function(x){if(IN_RET_CLUB){RET.wechat.init(retchatAccount,clubId,appid,x,mid);RET.Fb.init(retchatAccount,clubId,appid,x,mid);RET.line.init(retchatAccount,clubId,appid,x,mid)}MAIN_PROCESS.m_extra_param[PARAM_APP_NAME]=n();RET.cookieObj.getExtraCookieByRet(k.fetchCookieList,MAIN_PROCESS.m_extra_param);t(x);u(x);if(k.depthScroll==="ON"){h(x)}RET.utils.getUrlParamOrPath(k.urlFetchMap,window.location.href,MAIN_PROCESS.m_extra_param_q);var y=function(){if(!IN_RET_CLUB){if(k.tagRecommendStatus=="ON"||(k.domRecList&&k.domRecList.length>0)){return true}}return false};var v=function(){if(IN_RET_CLUB&&typeof retClubRecommendID!="undefined"&&!Number.isInteger(parseInt(retClubRecommendID))){return true}else{return false}};if(k.resTagPixelList&&k.resTagPixelList.length>0){RET.fSess.update(MAIN_PROCESS.m_extra_param,k.outlinkFilter);var w=RET.utils.getExtByUrlParam(k.urlFetchMap,window.location.href);RET.tagPixel.init(k.resTagPixelList,k.outlinkFilter,x,MAIN_PROCESS.m_extra_param[PARAM_SESSION_ID],MAIN_PROCESS.m_extra_param[PARAM_APP_NAME],MAIN_PROCESS.m_extra_param[PARAM_SITE_MEMBER],w);RET.tagPixel.exec()}if(k.tagExternalList&&k.tagExternalList.length>0){RET.tagExternal.init(k.tagExternalList);RET.tagExternal.exec()}console.log("exec recommendation start");if(IN_RET_CLUB||y()){RET.queryObj.init(RET.utils.extractRootUrl(retUrlPrefix),x);RET.cookieObj.getExtraCookieByRet(k.fetchCookieList,MAIN_PROCESS.m_extra_param_q);MAIN_PROCESS.m_extra_param_q.siteId=retSiteId;MAIN_PROCESS.m_extra_param_q[PARAM_APP_NAME]=n();RET.utils.handleRecommdationTriggerRule(k.triggerRuleVos);MAIN_PROCESS.m_extra_param_q.domIdListStr=RET.utils.getExistDomIdStr(k.domRecList);MAIN_PROCESS.m_extra_param_q.tagRecId=k.tagRecId;RET.fSess.update(MAIN_PROCESS.m_extra_param_q,k.outlinkFilter);RET.queryObj.query(MAIN_PROCESS.m_extra_param_q)}else{if(typeof retClubRecommendID!="undefined"&&Number.isInteger(parseInt(retClubRecommendID))){RET.queryObj.init(RET.utils.extractRootUrl(retUrlPrefix),x);RET.cookieObj.getExtraCookieByRet(k.fetchCookieList,MAIN_PROCESS.m_extra_param_q);MAIN_PROCESS.m_extra_param_q.siteId=retSiteId;MAIN_PROCESS.m_extra_param_q.recommendId=retClubRecommendID;RET.fSess.update(MAIN_PROCESS.m_extra_param_q,k.outlinkFilter);RET.queryObj.query(MAIN_PROCESS.m_extra_param_q)}}var A={};RET.cookieObj.getExtraCookieByRet(k.fetchCookieList,A);RET.sync.siteMember(x,retSiteId,A,retUrlPrefix);var z=RET.utils.getParameterByName("retpid",window.location.href);b(x,z,RET.utils.getParameterByName("catclk",window.location.href));previousUrl=window.location.href;g()};function b(x,z,w){if(k.tagTrackStatus=="ON"||IN_RET_CLUB){RET.eventObj.init(retUrlPrefix,window.location.href,x);MAIN_PROCESS.m_extra_param.siteId=retSiteId;MAIN_PROCESS.m_extra_param[PARAM_RET_TYPE]=d();delete MAIN_PROCESS.m_extra_param[PARAM_RET_CLICK_LABEL];if(d()==RET_TYPE_TRACK){delete MAIN_PROCESS.m_extra_param[PARAM_ITEM_ID]}if(w&&z!=x){MAIN_PROCESS.m_extra_param.catclk=w;MAIN_PROCESS.m_extra_param.retPid=z}else{delete MAIN_PROCESS.m_extra_param.catclk;delete MAIN_PROCESS.m_extra_param.retPid}if(k.urlFetchMap){var y=RET.utils.getExtByUrlParam(k.urlFetchMap,window.location.href);if(y!=null){var v=JSON.stringify(y);MAIN_PROCESS.m_extra_param[PARAM_CUSTOM_FIELD]=encodeURIComponent(v)}}if(d()==RET_TYPE_BUY){MAIN_PROCESS.m_extra_param[PARAM_SHOPPING_DETAIL]=RET.utils.prepareShoppingList(retOrderList)}else{if(d()==RET_TYPE_CART){MAIN_PROCESS.m_extra_param[PARAM_CART_DETAIL]=RET.utils.prepareShoppingList(retCartList)}else{if(d()!=RET_TYPE_TRACK){}}}RET.fSess.update(MAIN_PROCESS.m_extra_param,k.outlinkFilter);RET.eventObj.submit(MAIN_PROCESS.m_extra_param)}}function t(v){var x=RET.utils.getBrowserVersion();if((x.name=="MSIE"&&x.version<=9)){}else{if(window.history.pushState){var w=window.history.pushState;window.history.pushState=function(){w.apply(window.history,arguments);var y=window.location.href;if(previousUrl!==y){b(v,null,null);previousUrl=y}setTimeout(function(){RET.tagExternal.exec(true,"PUSH");RET.tagPixel.exec("PUSH")},100)}}if(window.history.replaceState){r=window.history.replaceState;window.history.replaceState=function(){r.apply(window.history,arguments);var y=window.location.href;if(previousUrl!==y){b(v,null,null);previousUrl=y}setTimeout(function(){RET.tagExternal.exec(true,"REPLACE");RET.tagPixel.exec("REPLACE")},100)};p=window.history.replaceState}}}function u(v){if(window.location.href.indexOf("#")!=-1){var w=location.hash.substring(1);s(k.resTagPixelList,w)}if(("onhashchange" in window)===true){window.onhashchange=function(){var x=location.hash.substring(1);if(l.indexOf(x)!=-1){return}s(k.resTagPixelList,x)}}}function s(A,z){if(A&&A.length>0){for(var x=0;x<A.length;x++){if(A[x].status==="ON"){var y=A[x].triggerList;for(var w=0;w<y.length;w++){for(var v=0;v<y[w].urlRegexList.length;v++){if(z.match(y[w].urlRegexList[v].key)){RET.tagPixel.execPixelEvent(A[x].htmlCodeTrack);l.push(z);return}}}}}}}function h(v){if(("onscroll" in window)){window.onscroll=function(){q(v)}}}function q(y){var w=window.innerHeight;var v=window.scrollY;for(var x=0;x<m.length;x++){if(!m[x]&&(w+v)*4>=c*(x+1)){if(r!=null&&p!=null){RET.eventObj.scrollDepthAction(MAIN_PROCESS.m_extra_param,25*(x+1),r,p)}else{RET.eventObj.scrollDepthAction(MAIN_PROCESS.m_extra_param,25*(x+1),window.history.replaceState,window.history.replaceState)}m[x]=true}}}function g(){if(!RET.tracking||!RET.tracking.q){console.log("Old version of snippet code. Can't use RET.tracking api.");return}console.log("On init ret success, ready to api process, queue:",RET.tracking.q);RET.tracking.q.push=function(v){j(v)};while(RET.tracking.q.length>0){j(RET.tracking.q.shift())}}function j(v){v=Array.prototype.slice.call(v);var w=v.shift();if(RET.api[w]){RET.api[w].apply(this,v)}}var i=function(){var x=CrxDomainStorage;var v=x.init(retUrlPrefix,SRV_HTML_PATH+(new Date().getDate()));if(v){console.log("ret.js: Going to use crxDomain");x.requestValue(CRX_RETUID_RETFSESS+"::"+retSiteId,function(A,C){var F=JSON.parse(C);ICEM_FT=F.ft;ICEM_FPID=F.fpid;var E=RET.utils.getBrowserVersion();console.log("browser info: "+JSON.stringify(E));var B=RET.cookieObj.getLocalCookie(RETUID_COOKIE);if((E.name=="Safari"&&E.version>=13)&&B){console.log("retuid inside Safari: "+B);ICEM_FPID=RET.cookieObj.generateLocalFpid();e(B)}else{var z=F.retUid;var D=F.sessionId;console.log("ret.js: get cookie from crxDomain: "+C);RET.cookieObj.setLocalCookie(RETUID_COOKIE,z,o);RET.cookieObj.setLocalCookie(FPID_COOKIE,ICEM_FPID,o);RET.fSess.setFess(D);e(z)}})}else{console.log("Browser does not support localStorage, create erUid on local domain");var w="RETJS-"+RET.cookieObj.generateLocalRetUid();var y="RETJS-"+RET.cookieObj.generateLocalFpid();ICEM_FT="t";ICEM_FPID=y;RET.cookieObj.setLocalCookie(RETUID_COOKIE,w,o);RET.cookieObj.setLocalCookie(FPID_COOKIE,y,o);e(w)}};var f=RET.utils.extractRootUrl(retUrlPrefix)+"agent/tagManager/getTagInfo/v1/"+retSiteId;RET.utils.httpClient(f,true,function(v){try{k=JSON.parse(v).data;this.m_fetch_cookie_List=k.fetchCookieList}catch(w){console.log("siteResponse is not JSON string");console.log(w)}i()})}}};(function(){if(typeof retchatAccount!="undefined"&&typeof clubId!="undefined"&&typeof appid!="undefined"){IN_RET_CLUB=true}RET.loadJS.init();var a=["client.min.js?v="+VERSION_CONTAINER_TAG,"md5.min.js","containerTag.js?v="+VERSION_CONTAINER_TAG];RET.loadJS.loadScripts(a,RET.loadJS.mainProcess)})();